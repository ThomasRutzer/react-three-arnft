{"version":3,"sources":["../../src/arnft/arnftContext.js"],"names":["React","createContext","useMemo","useContext","useEffect","useRef","useState","useCallback","useThree","ARNft","constraints","audio","video","facingMode","width","height","ARNftContext","ARNftProvider","children","interpolationFactor","cameraParamUrl","workerScriptUrl","onWorkerMessage","gl","camera","arnft","setARNft","arnftRef","onLoaded","msg","console","log","current","navigator","mediaDevices","getUserMedia","stream","srcObject","onloadedmetadata","event","srcElement","videoWidth","videoHeight","play","domElement","style","objectFit","updateProjectionMatrix","value","useARNft","arValue"],"mappings":"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","sourcesContent":["import React, {\n  createContext,\n  useMemo,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n  useCallback,\n} from \"react\"\nimport { useThree } from \"@react-three/fiber\"\nimport { ARNft } from \"./arnft\"\n\nconst constraints = {\n  audio: false,\n  video: {\n    facingMode: \"environment\",\n    width: 640,\n    height: 480,\n  },\n}\n\nconst ARNftContext = createContext({})\n\nconst ARNftProvider = ({\n  children,\n  video,\n  interpolationFactor,\n  cameraParamUrl,\n  workerScriptUrl,\n  onWorkerMessage,\n}) => {\n  const { gl, camera } = useThree()\n  const [arnft, setARNft] = useState(null)\n  const arnftRef = useRef()\n\n  const onLoaded = useCallback((msg) => {\n    console.log(\"onLoaded\", msg)\n\n    setARNft(arnftRef.current)\n  }, [])\n\n  useEffect(async () => {\n    const stream = await navigator.mediaDevices.getUserMedia(constraints)\n    video.current.srcObject = stream\n    video.current.onloadedmetadata = async (event) => {\n      console.log(event.srcElement.videoWidth)\n      console.log(event.srcElement.videoHeight)\n\n      video.current.play()\n\n      gl.domElement.width = event.srcElement.videoWidth\n      gl.domElement.height = event.srcElement.videoHeight\n\n      gl.domElement.style.objectFit = \"cover\"\n\n      camera.updateProjectionMatrix()\n\n      const arnft = new ARNft(\n        video.current,\n        gl,\n        camera,\n        onLoaded,\n        onWorkerMessage,\n        cameraParamUrl,\n        workerScriptUrl,\n        interpolationFactor,\n      )\n\n      arnftRef.current = arnft\n    }\n  }, [])\n\n  const value = useMemo(() => {\n    return { arnft: arnft }\n  }, [arnft])\n\n  return <ARNftContext.Provider value={value}>{children}</ARNftContext.Provider>\n}\n\nconst useARNft = () => {\n  const arValue = useContext(ARNftContext)\n  return useMemo(() => ({ ...arValue }), [arValue])\n}\n\nexport { ARNftProvider, useARNft, ARNftContext }\n"],"file":"arnftContext.js"}